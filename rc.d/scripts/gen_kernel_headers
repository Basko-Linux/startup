#!/bin/sh -e
# 
# This script generates headers required by
# /usr/include/linux/{autoconf,modversions,version}.h
#
# Copyright (C) 2001  Dmitry V. Levin <ldv@fandra.org>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#

B=/var/run/kernel
cd "$B"

K="$(uname -r)"
[ -d "/usr/lib/kernel/$K" ]

for n in autoconf modversions version; do
	cat >"$n.h" << EOF
/*
 * Autogenerated by $0 at $(LANG=C date '+%a %b %d %Y %T')
*/

#ifndef	__boot_kernel_${n}__
#define	__boot_kernel_${n}__

#include </usr/lib/kernel/$K/$n.h>

#endif	/* __boot_kernel_${n}__ */
EOF
done

H2PH=/usr/bin/h2ph
if [ -x "$H2PH" ]; then
	"$H2PH" -l -Q -d "$B" {autoconf,modversions,version}.h
fi
